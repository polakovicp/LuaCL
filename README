TODO:
-remove all global variables
-change error handling
- and so on ...